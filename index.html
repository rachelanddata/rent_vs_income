<!DOCTYPE html>
<meta charset="utf-8">
<style>
    path {
        fill: #d3d3d3;
        stroke: #000;
        stroke-width: .5px;
    }
    
    div.tooltip {
        position: absolute;
        text-align: center;
        width: 150px;
        height: 25px;
        padding: 2px;
        font-size: 12px;
        background: #e2e6ea;
        border: 1px;
        border-radius: 8px;
        pointer-events: none;
    }

</style>

<head>
    <title>Texas: 2 Bedroom Rent as a Percentage of Minimum Wage Income</title>
</head>

<body>
    <script src="//d3js.org/d3.v3.min.js"></script>

    <script src="//d3js.org/topojson.v1.min.js"></script>
    <script>
        var width = 960,
            height = 1160;

        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        var projection = d3.geo.albersUsa()
            .scale(2500)
            .translate([width / 2, height / 50]);

        // threshold scale for the data (DIFFERENCE %)
        var color = d3.scale.threshold()
            .domain([20, 40, 60, 80, 100])
            .range(["#feedde", "#fdbe85", "#fd8d3c", "#e6550d", "#a63603"]);

        var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        var path = d3.geo.path()
            .projection(projection);


        d3.json("Texas.topo.json", function(error, topology) {
            if (error) throw error;



            d3.csv("rent_data.csv", function(error, rent) {

                var rateById = {}; // Create empty object for holding dataset

                rent.forEach(function(d, i) {
                    topology.objects.tx_counties.geometries.forEach(function(e, j) {
                        if (d.fips == e.properties.FIPS) {
                            e.properties.perc2br = d.perc2br;
                        }
                        rateById[d.fips] = +d.perc2br;
                        //console.log(e);
                    })
                });

                svg.selectAll("path")
                    .data(topojson.feature(topology, topology.objects.tx_counties).features)
                    .enter().append("path")
                    .attr("d", path)
                    .style("fill", function(d) {
                        return color(rateById[d.properties.FIPS])


                    })
                    .on("mouseover", function(d) {
                        d3.select(this).transition().duration(300).style("opacity", 1);
                        div.transition().duration(300)
                            .style("opacity", 1)
                        div.text(d.properties.COUNTY + " : " + d.properties.perc2br + "% of income")
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 30) + "px");
                    })
                    .on("mouseout", function() {
                        d3.select(this)
                            .transition().duration(300)
                            .style("opacity", 0.8)
                        div.transition().duration(300)
                            .style("opacity", 0);
                    });

            })
        });

    </script>
